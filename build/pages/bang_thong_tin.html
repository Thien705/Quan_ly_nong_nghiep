<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω n√¥ng nghi·ªáp</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; }
    table thead th {
      background-color: #16a34a; /* xanh l√° ƒë·∫≠m */
      color: white !important;
      text-transform: uppercase;
      font-size: 0.9rem;
      letter-spacing: 0.5px;
    }
    table tbody tr:nth-child(even) {
      background-color: #f0fdf4; /* xanh l√° nh·∫°t */
    }
    table tbody tr:hover {
      background-color: #dcfce7; /* hover highlight */
      transition: 0.2s;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-green-100 to-green-50 min-h-screen flex">
  
  <!-- Sidebar -->
  <aside class="fixed inset-y-0 left-0 flex flex-col w-64 bg-gradient-to-b from-green-600 to-green-400 shadow-xl rounded-r-3xl z-50">
    <div class="flex items-center gap-3 px-8 py-6">
      <img src="../assets/img/logo-ct-dark.png" class="h-10" alt="main_logo" />
      <span class="font-bold text-xl text-white">Qu·∫£n l√Ω n√¥ng nghi·ªáp</span>
    </div>
    <hr class="border-t border-green-300 mx-8 mb-4" />
    
    <!-- Menu -->
    <nav class="flex flex-col gap-2 px-4">
      <a href="trang_chu.html" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-white/90 text-gray-700 font-medium shadow transition duration-200 hover:shadow-lg hover:bg-green-100 hover:scale-105">
        <i class="fas fa-home text-xl text-green-500"></i>
        <span>Trang ch·ªß</span>
      </a>
      <a href="bang_thong_tin.html" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-white/90 text-gray-700 font-medium shadow transition duration-200 hover:shadow-lg hover:bg-green-100 hover:scale-105">
        <i class="fas fa-table text-xl text-yellow-400"></i>
        <span>B·∫£ng th√¥ng tin</span>
      </a>
      <a href="admin_cay_trong.html" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-white/90 text-gray-700 font-medium shadow transition duration-200 hover:shadow-lg hover:bg-green-100 hover:scale-105">
        <i class="fas fa-seedling text-xl text-emerald-400"></i>
        <span>Qu·∫£n l√Ω c√¢y tr·ªìng</span>
      </a>
      <a href="admin_nong_dan.html" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-white/90 text-gray-700 font-medium shadow transition duration-200 hover:shadow-lg hover:bg-green-100 hover:scale-105">
        <i class="fas fa-users text-xl text-cyan-400"></i>
        <span>Qu·∫£n l√Ω n√¥ng d√¢n</span>
      </a>
      <a href="admin_thua_dat.html" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-white/90 text-gray-700 font-medium shadow transition duration-200 hover:shadow-lg hover:bg-green-100 hover:scale-105">
        <i class="fas fa-map-marked-alt text-xl text-red-400"></i>
        <span>Qu·∫£n l√Ω th·ª≠a ƒë·∫•t</span>
      </a>

      <div class="mt-6 mb-2 px-4 text-xs text-gray-500 uppercase tracking-wide font-semibold">Trang c√° nh√¢n</div>

      <a href="dang_nhap.html" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-white/90 text-gray-700 font-medium shadow transition duration-200 hover:shadow-lg hover:bg-green-100 hover:scale-105">
        <i class="fas fa-sign-in-alt text-xl text-orange-400"></i>
        <span>ƒêƒÉng nh·∫≠p</span>
      </a>
      <a href="dang_ky.html" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-white/90 text-gray-700 font-medium shadow transition duration-200 hover:shadow-lg hover:bg-green-100 hover:scale-105">
        <i class="fas fa-user-plus text-xl text-cyan-400"></i>
        <span>ƒêƒÉng k√Ω</span>
      </a>
    </nav>
  </aside>

  <!-- Main content -->
  <main class="flex-1 ml-64 p-6 space-y-8">
    <!-- Khung t√™n user nh∆∞ trang ch·ªß, ·ªü gi·ªØa -->
    <div class="flex justify-between items-center mb-8">
      <div>
        <h1 class="text-2xl font-bold" id="welcome-title">Xin ch√†o</h1>
      </div>
      <div id="user-info" class="flex items-center gap-2">
        <span class="font-semibold text-green-700 border border-green-500 rounded px-3 py-1 bg-white shadow" id="username-display"></span>
        <a href="dang_nhap.html" class="text-sm text-blue-500 underline">ƒêƒÉng xu·∫•t</a>
      </div>
    </div>
    <!-- Thanh t√¨m ki·∫øm ·ªü gi·ªØa -->
    <div class="flex justify-center mb-8">
      <input
        type="text"
        id="searchInput"
        placeholder="T√¨m ki·∫øm th√¥ng tin..."
        class="px-4 py-2 rounded-lg border border-green-300 shadow focus:outline-none focus:ring-2 focus:ring-green-400 w-80"
      />
    </div>

    <!-- B·∫£ng c√¢y tr·ªìng -->
    <div class="bg-white shadow-lg rounded-2xl overflow-hidden">  
      <div class="p-6 border-b bg-green-50 sticky top-0 z-10">
        <h6 class="font-semibold text-lg text-green-700">üå± Danh s√°ch c√°c c√¢y tr·ªìng</h6>
      </div>
      <div class="overflow-x-auto" style="max-height: 260px; overflow-y: auto;">
        <table class="w-full text-sm text-gray-700">
          <thead class="sticky top-0 z-10">
            <tr>
              <th class="px-6 py-3 text-left">STT</th>
              <th class="px-6 py-3 text-left">M√É C√ÇY</th>
              <th class="px-6 py-3 text-left">T√äN C√ÇY</th>
              <th class="px-6 py-3 text-left">C√ÅCH CANH T√ÅC</th>
              <th class="px-6 py-3 text-left">PH√ÇN B√ìN</th>
              <th class="px-6 py-3 text-left">NGU·ªíN G·ªêC</th>
            </tr>
          </thead>
          <tbody class="addListCayTrong"></tbody>
        </table>
      </div>
    </div>

    <!-- B·∫£ng n√¥ng d√¢n -->
    <div class="bg-white shadow-lg rounded-2xl overflow-hidden">
      <div class="p-6 border-b bg-green-50 sticky top-0 z-10">
        <h6 class="font-semibold text-lg text-green-700">üë©‚Äçüåæ Danh s√°ch n√¥ng d√¢n</h6>
      </div>
      <div class="overflow-x-auto" style="max-height: 260px; overflow-y: auto;">
        <table class="w-full text-sm text-gray-700">
          <thead class="sticky top-0 z-10">
            <tr>
              <th class="px-6 py-3 text-left">STT</th>
              <th class="px-6 py-3 text-left">M√É ND</th>
              <th class="px-6 py-3 text-left">H·ªå T√äN</th>
              <th class="px-6 py-3 text-left">ƒê·ªäA CH·ªà</th>
            </tr>
          </thead>
          <tbody class="addListNongDan"></tbody>
        </table>
      </div>
    </div>

    <!-- B·∫£ng th·ª≠a ƒë·∫•t -->
    <div class="bg-white shadow-lg rounded-2xl overflow-hidden">
      <div class="p-6 border-b bg-green-50 sticky top-0 z-10">
        <h6 class="font-semibold text-lg text-green-700">üìç Danh s√°ch c√°c th·ª≠a ƒë·∫•t</h6>
      </div>
      <div class="overflow-x-auto" style="max-height: 260px; overflow-y: auto;">
        <table class="w-full text-sm text-gray-700">
          <thead class="sticky top-0 z-10">
            <tr>
              <th class="px-6 py-3 text-left">STT</th>
              <th class="px-6 py-3 text-left">M√É TH·ª¨A ƒê·∫§T</th>
              <th class="px-6 py-3 text-left">T√äN TH·ª¨A ƒê·∫§T</th>
              <th class="px-6 py-3 text-left">M√É N√îNG D√ÇN</th>
              <th class="px-6 py-3 text-left">ƒê·ªäA CH·ªà</th>
              <th class="px-6 py-3 text-left">M√É C√ÇY</th>
              <th class="px-6 py-3 text-left">B·∫ÆT ƒê·∫¶U</th>
              <th class="px-6 py-3 text-left">K·∫æT TH√öC</th>
            </tr>
          </thead>
          <tbody class="addListThuaDat"></tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>
  let listNongDan = [];
let listCayTrong = [];

function showNongDan(){
    $.ajax({
        url: "http://localhost/qlvt/php/Nong_Dan/api_get_nong_dan.php",
        type: "POST",
        dataType: "json",
        success: function(res) {
            listNongDan = res; // L∆∞u l·∫°i danh s√°ch n√¥ng d√¢n
            let s = '';
            let stt = 1;
            res.forEach(item => {
                s += `
                <tr>
                  <td class="px-6 py-3">${stt++}</td>
                  <td class="px-6 py-3">${item.MaND}</td>
                  <td class="px-6 py-3">${item.HoTen}</td>
                  <td class="px-6 py-3">${item.DiaChi}</td>
                </tr>`;
            });
            $('.addListNongDan').html(s);
        }
    });
}

function showCayTrong(){
    $.ajax({
        url: "http://localhost/qlvt/php/Cay_Trong/api_get_cay_trong.php",
        type: "POST",
        dataType: "json",
        success: function(res) {
            listCayTrong = res; // L∆∞u l·∫°i danh s√°ch c√¢y tr·ªìng
            let s = '';
            let stt = 1;
            res.forEach(item => {
                s += `
                <tr>
                  <td class="px-6 py-3">${stt++}</td>
                  <td class="px-6 py-3">${item.MaC}</td>
                  <td class="px-6 py-3">${item.TenC}</td>
                  <td class="px-6 py-3">${item.CachCanhTac}</td>
                  <td class="px-6 py-3">${item.PhanBon}</td>
                  <td class="px-6 py-3">${item.NguonGoc}</td>
                </tr>`;
            });
            $('.addListCayTrong').html(s);
        }
    });
}

function showThuaDat(){
    $.ajax({
        url: "http://localhost/qlvt/php/Thua_Dat/api_get_thua_dat.php",
        type: "POST",
        dataType: "json",
        success: function(res) {
            let s = '';
            let stt = 1;
            res.forEach(item => {
                s += `
                <tr>
                  <td class="px-6 py-3">${stt++}</td>
                  <td class="px-6 py-3">${item.MaTD}</td>
                  <td class="px-6 py-3">${item.TenTD}</td>
                  <td class="px-6 py-3">${item.MaND}</td>
                  <td class="px-6 py-3">${item.DiaChi}</td>
                  <td class="px-6 py-3">${item.MaC}</td>
                  <td class="px-6 py-3">${item.ThoiGianBatDau}</td>
                  <td class="px-6 py-3">${item.ThoiGianKetThuc}</td>
                </tr>`;
            });
            $('.addListThuaDat').html(s);
        }
    });
}

  // H√†m l·ªçc b·∫£ng theo t·ª´ kh√≥a
  function filterTables(keyword) {
  keyword = keyword.toLowerCase();

  // T√¨m c√°c m√£ c√¢y li√™n quan ƒë·∫øn keyword ·ªü b·∫£ng c√¢y tr·ªìng
  let matchedMaC = [];
  $('.addListCayTrong tr').each(function() {
    let maC = $(this).find('td').eq(1).text().trim();
    let tenC = $(this).find('td').eq(2).text().toLowerCase();
    if (tenC.indexOf(keyword) > -1 || maC.toLowerCase().indexOf(keyword) > -1) {
      matchedMaC.push(maC);
    }
  });

  // T√¨m c√°c m√£ n√¥ng d√¢n li√™n quan ƒë·∫øn keyword ·ªü b·∫£ng n√¥ng d√¢n
  let matchedMaND = [];
  $('.addListNongDan tr').each(function() {
    let maND = $(this).find('td').eq(1).text().trim();
    let hoTen = $(this).find('td').eq(2).text().toLowerCase();
    if (hoTen.indexOf(keyword) > -1 || maND.toLowerCase().indexOf(keyword) > -1) {
      matchedMaND.push(maND);
    }
  });

  // T√¨m c√°c th·ª≠a ƒë·∫•t li√™n quan ƒë·∫øn m√£ c√¢y ho·∫∑c m√£ n√¥ng d√¢n
  let matchedMaTD = [];
  $('.addListThuaDat tr').each(function() {
    let maTD = $(this).find('td').eq(1).text().trim();
    let maND_td = $(this).find('td').eq(3).text().trim();
    let maC_td = $(this).find('td').eq(5).text().trim();
    if (matchedMaC.includes(maC_td) || matchedMaND.includes(maND_td)) {
      matchedMaTD.push(maTD);
    }
  });

  // N·∫øu search c√¢y tr·ªìng, l·∫•y MaND t·ª´ th·ª≠a ƒë·∫•t li√™n quan v√† hi·ªán n√¥ng d√¢n ƒë√≥
  if (matchedMaC.length > 0 && matchedMaND.length === 0) {
    $('.addListThuaDat tr').each(function() {
      let maC_td = $(this).find('td').eq(5).text().trim();
      let maND_td = $(this).find('td').eq(3).text().trim();
      if (matchedMaC.includes(maC_td)) {
        if (!matchedMaND.includes(maND_td)) matchedMaND.push(maND_td);
      }
    });
  }

  // N·∫øu search n√¥ng d√¢n, l·∫•y MaC t·ª´ th·ª≠a ƒë·∫•t li√™n quan v√† hi·ªán c√¢y tr·ªìng ƒë√≥
  if (matchedMaND.length > 0 && matchedMaC.length === 0) {
    $('.addListThuaDat tr').each(function() {
      let maND_td = $(this).find('td').eq(3).text().trim();
      let maC_td = $(this).find('td').eq(5).text().trim();
      if (matchedMaND.includes(maND_td)) {
        if (!matchedMaC.includes(maC_td)) matchedMaC.push(maC_td);
      }
    });
  }

  // Hi·ªán c√¢y tr·ªìng li√™n quan
  $('.addListCayTrong tr').each(function() {
    let maC = $(this).find('td').eq(1).text().trim();
    let tenC = $(this).find('td').eq(2).text().toLowerCase();
    $(this).toggle(matchedMaC.includes(maC) || tenC.indexOf(keyword) > -1);
  });

  // Hi·ªán n√¥ng d√¢n li√™n quan
  $('.addListNongDan tr').each(function() {
    let maND = $(this).find('td').eq(1).text().trim();
    let hoTen = $(this).find('td').eq(2).text().toLowerCase();
    $(this).toggle(matchedMaND.includes(maND) || hoTen.indexOf(keyword) > -1);
  });

  // Hi·ªán th·ª≠a ƒë·∫•t li√™n quan
  $('.addListThuaDat tr').each(function() {
    let maTD = $(this).find('td').eq(1).text().trim();
    $(this).toggle(matchedMaTD.includes(maTD));
  });
}

  $(document).ready(function(){
    showCayTrong();
    showNongDan();
    showThuaDat();

    $('#searchInput').on('input', function() {
      filterTables($(this).val());
    });
  });

  // Hi·ªÉn th·ªã t√™n ƒëƒÉng nh·∫≠p ·ªü g√≥c tr√™n ph·∫£i v√† ti√™u ƒë·ªÅ
  const username = localStorage.getItem("username");
  if (username) {
    document.getElementById("username-display").textContent = username;
    document.getElementById("welcome-title").textContent = `Xin ch√†o ${username}`;
  } else {
    document.getElementById("username-display").textContent = "Kh√°ch";
    document.getElementById("welcome-title").textContent = "Xin ch√†o Kh√°ch";
  }
  </script>
</body>
</html>
